# ロボカップ2016設計詳細

## 使用するマイコンとその内訳
- LPC1768(純正)
	- IO:26
		- PWM:6
		- I2C:2x2
- LPC1114
	- IO:17
		- PWM:4
		- I2C:2x1
- (NUCLEO-F303K8)
	- IO:21
		- PWM:12
		- I2C:2x1

## マイコン使用
下記6つのモジュールに対して、一つずつマイコンを使用する
- メイン
- IR
- キッカー、ドリブラ
- 超音波
- コントローラ
- 電圧・電流

## ピン使用
- メイン(LPC1768)
	- モータ I/O(2x3), PWM(1x3)
	- I2C(2x2)
		- コンパス
		- コントローラとの通信
		- IR処理マイコンとの通信
		- 超音波センサ管理マイコンとの通信
	- ライン I/O(1x4)
	- デバッグ用LED
- IR(LPC1114)
	- I/O(1x12)
	- I/O far(1x2)
	- I2C(2x1)
		- メインマイコンとの通信
- キッカー、ドリブラ(LPC1114)
	- ドリブラ(モータ) I/O(2x1), PWM(1x1)
	- キッカー
		- IR I/O(1x1)
		- キッカー I/O(1x1)
	- デバッグ用LED
- 超音波(LPC1114)
	- 超音波 I/O(2x3)
	- I2C(2x1)
		- メインマイコンとの通信
- コントローラ(LPC1114)
	- モードの切り替え (ピン未定)
	- その他デバッグ (ピン未定)
	- I2C(2x1)
		- メインマイコンとの通信
- 電圧・電流監視(LPC1114)
	- 7セグ(12x1)
	- 圧電ブザー PWM(1x1)
	- ボタン I/O(1x1)
	- I2C(2x1)
		- INA226との通信
	- メインマイコンへの信号送信 I/O(1x1)

## 設計
### メイン
- Classes
	- __Compass__
		- \# コンパスの管理
		- ディジタルコンパスモジュールによって取得した角度をmainに渡す
		- HMC6352クラスのラッパークラス
	- __Motor__
		- \# モータ制御
		- 一つのモータの制御を行う
	- __MotorThreeWheeler__
		- \# 三つのモータの制御
		- Motorクラスを包含している
		- 主に3輪ロボットのモータ制御を行う
- main
	- \# すべてのマイコンとの通信および統括
	- Compassクラスから受け取った角度を元に、ロボットの方向の調整を行う
	- Motorクラスを用いて、ロボットを走らせる
	- IR用のマイコンから受け取った値を元に、ボールを追いかける
	- ラインセンサから受け取った値を用いてモータを制御し、アウト・オブ・バウンズを防ぐ
	- 超音波センサから受け取った値を用いてモータを制御し、アウト・オブ・バウンズを防ぐ
	- LED等を用いて、さまざまなデバッグを行う
	- コントローラマイコンから受け取った値を元に、モードの切り替えを行う
	- 電圧電流監視用のマイコンから受け取った値を評価し、緊急停止等を行う
	- キッカー・ドリブラ用マイコンに、キック命令を出す
	- コントローラマイコンに、各種センサーの値を送る

### IR
- main
	- \# IRセンサの管理
	- IRセンサから受け取った値を整理し、メインマイコンに送信する

### キッカー・ドリブラ
- Classes
	- __Kicker__
		- \# キッカーの制御
		- キックするべきか判断し、それに応じて動作させる
- main
	- \# キッカー・ドリブラの制御
	- ボールがロボットの目の前に来て、かつメインマイコンからキック命令が来たときにキックする
	- メインマイコンに、ボールをホールドしているかどうかの信号を送信する

### 超音波
- Classes
	- __Ultrasonic__
		- \# 超音波センサの管理
		- 超音波センサから受け取った値を評価し、それをmainに渡す
		- HCSR04クラスのラッパークラス
- main
	- \# 超音波センサの管理
	- Ultrasonicクラスから受け取った値をメインマイコンに送信する

### コントローラ
- Classes
	- __Control__
		- \# コントロールパネル
		- その他未定
- main
	- \# コントロールパネル
	- スイッチから受け取った値をメインマイコンに送信する。モード切り替えを行う
	- メインマイコンから受け取った各種センサーの値をLCDに表示する

### 電圧電流監視
- Classes
	- __Limit__
		- \# 電圧と電流の値を監視する
		- 電圧電流センサから受け取った値を評価し、それをmainに渡す
		- その他未定
	- __SevenSegmentLED__
		- \# 7セグメントLEDの管理・表示の簡略化
		- mainから受け取った値を7セグメントLEDに表示する
- main
	- \# 電圧と電流の値を監視する
	- Limitクラスから受け取った値をメインマイコンに送信する

## Todo
- main
	- [ ] 大まかなアルゴリズム作成
	- [ ] 各モジュールの優先順位付け
- IR
	- [ ] アルゴリズム作成(small task)
- キッカー・ドリブラ
	- [x] 二つの兼ね合いを考える
	- [x] Kickerクラスの動作確認
	- [x] アルゴリズム作成
- 超音波
	- [x] アルゴリズム作成(small task)
- コントローラ
	- [x] このマイコンで他に何を行うか考える
	- モードの作成
		- [ ] Normal Mode
		- [ ] Keeper Mode
		- [ ] Line-Trace Mode
		- [ ] Kamikaze Mode
		- Debug Mode
			- [ ] IR
			- [ ] Ultrasonic
			- [ ] Line
	- [ ] アルゴリズム作成
- 実践的なこと
	- [ ] 足回りの調整
	- [ ] PID制御
	- [ ] 必要最小限を実装し、擬似的に動かす
- other
	- [ ] ノイズ除去
	- [x] 複数のデバイスでI2C通信を行う
	- [ ] I2C通信をしながらpc.printfが出来るかどうか(Serial通信との兼ね合いで出来ない可能性)
	- [x] クラスからインスタンス名の取得
