# ロボカップ2016設計詳細

## 使用するマイコンとその内訳
- LPC1768
	- IO:22
	- PWM:6
	- I2C:2x2
- LPC1114
	- IO:15
	- PWM:4
	- I2C:2x1

## マイコン使用
下記6つのモジュールに対して、一つずつマイコンを使用する
- メイン、モータ、コンパス、ライン
- IR
- キッカー、ドリブラ
- 超音波
- コントローラ
- 7セグ・電圧電流

## ピン使用
- メイン(LPC1768)
	- モータ I/O(2x3), PWM(1x3)
	- I2C(2x2)
		- コンパス
		- コントローラとの通信
		- IR処理マイコンとの通信
		- 超音波センサ管理マイコンとの通信
	- ライン I/O(1x4)
	- デバッグ用LED
- IR(LPC1114)
	- I/O(1x12)
	- I/O far(1x2)
	- I2C(2x1)
		- メインマイコンとの通信
- キッカー、ドリブラ(LPC1114)
	- ドリブラ(モータ) I/O(2x1), PWM(1x1)
	- キッカー
		- IR I/O(1x1)
		- キッカー I/O(1x1)
	- デバッグ用LED
- 超音波(LPC1114)
	- 超音波 I/O(2x3)
	- I2C(2x1)
		- メインマイコンとの通信
- コントローラ(LPC1114)
	- I2C(2x1)
		- メインマイコンとの通信
- 7セグ・電圧電流(LPC1114)
	- 7セグ(12x1)
	- 圧電ブザー PWM(1x1)
	- ボタン I/O(1x1)
	- I2C(2x1)
		- INA226との通信
	- メインマイコンへの信号送信 I/O(1x1)

## Policy
- クラス名はパスカルケース(SomeClass)
- 変数名、メソッド名はスネークケース(some_variable, some_method)

- __ClassName__
	- \# クラスの説明
	- [variable] varName : type
		- 変数の説明
	- [constructor] ClassName()
		- コンストラクタの説明
	- [initializer] initializerName : UseClassName(PinName)
		- ピン割り当ての説明
	- [func] FuncName() -> return_type
		- 関数の説明
	- [func] FuncName(type *args*)
		- 引数は斜体にする。返り値がない場合は`->`を省略

## Classes
- __Control__
	- \# 全体の制御
- __Motor__
	- \# モータの制御
	- public
		- [constructor] Motor(PinName *normalDirect*, PinName *reverseDirect*, PinName *pwm*)
			- 正転、逆転方向のピン(DigitalOut)、duty比調整のピン(PWM)の設定
		- [destructor] ~Motor()
			- powerLimit(pwm)のメモリ解放
		- [function] setLimit(float *powerLimit* = 1) -> int
			- duty比の上限を決める
			- 引数が適切な値だった場合(0 ~ 1)は0を、そうでなかった場合は1を返す
		- [function] setFlequency(float *correctFlequency*)
			- 周波数を設定する
		- [function] run(float *power*)
			- モータを回す
		- [function] brake(void)
			- ブレーキ
	- private
		- [initializer] \*powerLevel : PwmOut(pwm)
			- duty比設定のためのピンの割り当て
		- [initializer] normal : DigitalOut(normalDirect)
			- 正転方向のピンの割り当て
		- [initializer] reverse : DigitalOut(reverseDirect)
			- 逆転方向のピンの割り当て
		- [variable] limit : float
			- duty比の上限
		- [function] rotateNormal(void)
			- 時計回りに回転
		- [function] rotateReverse(void)
			- 反時計回りに回転
- __Infrared__
	- \# 赤外線ボールの位置を検知
	- public
		- [constructor] Infrared(PinName *front*, PinName *frontLeft*, PinName *left*, PinName *backLeft*, PinName *back*, PinName *backRight*, PinName *right*, PinName *frontRight*)
			- 8方位の、それぞれのピン(DigitalIn)の設定
		- [function] findBallPos(void) -> char
			- 8方位の反応の有無を返す
	- private
		- [initializer] infraredData : BusIn
- __AnalogInfrared__
	- \# 赤外線ボールの位置と距離を検知
	- public
		- [constructor] AnalogInfrared(PinName *front*, PinName *frontLeft*, PinName *left*, PinName *backLeft*, PinName *back*, PinName *backRight*, PinName *right*, PinName *frontRight*)
			- 8方位の、それぞれのピン(AnalogIn)の設定
		- [function] findBallPosAndDist(char *data[]*)
	- private
		- [initializer] AnalogIn analogFront;
		- [initializer] AnalogIn analogFrontLeft;
		- [initializer] AnalogIn analogLeft;
		- [initializer] AnalogIn analogBackLeft;
		- [initializer] AnalogIn analogBack;
		- [initializer] AnalogIn analogBackRight;
		- [initializer] AnalogIn analogRight;
		- [initializer] AnalogIn analogFrontRight;
			- 以上8つは、8方位のピンの設定
- __Compass__
	- \# 角度入手
	- public
		- [constructor] Compass(PinName *sda*, PinName *scl*)
			- データ(I2C sda)、クロック(I2c scl)のピンと初期角度の設定
		- [destructor] ~Compass()
			- hmc6352(sda, scl)のメモリ解放
		- [function] measureAngle(void) -> float
			- 初期角度との差分を返す
	- private
		- [initializer] \*hmc6352 : HMC6352(sda, scl)
			- データ、クロックピンの割り当て(I2C通信を用いる)
		- [variable] initialAngle : float
			- 初期角度
- __Ultrasonic__
	- \# 障害物との距離の入手
	- public
		- [constructor] Ultrasonic(PinName *trig*, PinName *echo*)
			- トリガーとエコーピン(DigitalIn)の設定
		- [destructor] ~Ultrasonic()
			- hcsr04(trig, echo)のメモリ解放
		- [function] measureDist(void) -> int
			- 障害物との距離を返す
	- private
		- [initializer] \*hcsr04 HCSR04(trig, echo)
			- トリガー、エコーピンの割り当て
- __Line__
	- \# 白線の上に乗っているかを調べる
	- public
		- [constructor] Line(PinName *right*, PinName *back*, PinName *left*)
			- 右、後ろ、左のそれぞれのピン(DigitalIn)の設定
		- [function] findOnLine(void) -> char
			- 白線に乗っているかを返す
	- private
		- [initializer] lineData : BusIn
			- データを受け取るピンの割り当て
- __Kicker__
	- \# 蹴る
	- public
		- [constructor] Kicker(PinName *kicker_*, PinName *brightness_*)
			- キッカー(DigitalOut)、ボール接触センサ(DigitalIn)のピンの設定と、時間測定開始
		- [destructor] ~Kicker()
			- Timerをリセットし、ストップ
		- [function] kick(void)
			- キックする
	- private
		- [initializer] kicker : DigitalOut
			- キッカー用のピンの割り当て
		- [initializer] brightness : DigitalIn
			- ボール接触センサ用のピンの割り当て
		- [initializer] timer : Timer
			- 秒数を数える
		- [constant] interval : int
			- キックする間隔
		- [variable] enableKick : bool
			- キックすべきかどうかのフラグ
		- [function] count(void)
			- 秒数を数える
- __Dribbler__
	- \# ドリブルする
	- public
		- [constructor] Dribbler(PinName *normalDirect*, PinName *reverseDirect*, PinName *pwm*, PinName *dribblerIR_*)
			- 正転、逆転方向のピン(DigitalOut)、duty比調整のピン(PWM)とドリブラ用IR(DigitalIn)ピンの設定
			- duty比の上限の設定
		- [function] dribble(float *power*)
			- ドリブルする
	- private
		- [initializer] dribblerIR : DigitalIn
			- ドリブラ用IRセンサのピンの割り当て
		- [initializer] dribblerMotor : Motor
			- Motorクラスを用いる(包含)
- __PIDSup__
	- \# PID制御のライブラリの補助
- __CommuMaster__
	- \# 通信(master)の管理
	- public
		- [constructor] CommuMaster(PinName *sda*, PinName *scl*)
			- データ(I2C sda)、クロック(I2c scl)のピンの設定
		- [destructor] ~CommuMaster()
			- i2cmaster(sda, scl)のメモリ解放
		- [function] init(int *correctFlequency*, char *addr*)
			- 周波数及びアドレスの設定
		- [function] receiveData(char *data[]*)
			- 値を受け取り、第一引数の配列に格納
	- private
		- [initializer] \#i2cmaster I2CMaster(sda, scl)
			- データ、クロックピンの割り当て
		- [variable] addr : char
			- 受け取ったアドレス
- __CommuSlave__
	- \# 通信(slave)の管理
	- コンストラクタ、デストラクタ、初期化関数はmasterと同じ
		- public
			- [function] sendData(char *data[]*)
				- 第一引数にとった配列を送る
		- private
			- [initializer] \*i2cslave I2CSlave(sda, scl)
				- データ、クロックピンの割り当て

## Todo
- [x] 複数のデバイスでI2C通信を行う
- [ ] 電流・電圧監視の具体的な実装
- [ ] 必要最小限を実装し、擬似的に動かす
- [ ] I2C通信をしながらpc.printfが出来るかどうか
